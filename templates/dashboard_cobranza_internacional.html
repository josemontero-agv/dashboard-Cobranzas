{% extends 'base.html' %}

{% block title %}Dashboard Cobranza Internacional{% endblock %}

{% block content %}
<div class="dashboard-cobranza">
<!-- Header estilo Dashboard amplio -->
<div class="dashboard-header">
    <div class="header-left">
        <div class="header-info">
            <h1>DASHBOARD COBRANZA INTERNACIONAL</h1>
        </div>
    </div>
    <div class="header-nav">
        <button onclick="window.location.href='{{ url_for('reporte_internacional') }}'" class="btn-nav">
            <i class="bi bi-file-earmark-excel"></i> Ver Reporte
        </button>
        
        <!-- Dropdown Ventas -->
        <div class="nav-dropdown">
            <button class="nav-dropdown-toggle">
                <i class="bi bi-graph-up-arrow"></i> Ventas <i class="bi bi-chevron-down"></i>
            </button>
            <div class="nav-dropdown-menu">
                <a href="{{ url_for('dashboard') }}"><i class="bi bi-speedometer2"></i> Dashboard General</a>
                <a href="{{ url_for('dashboard_linea') }}"><i class="bi bi-bar-chart-line"></i> Dashboard por Línea</a>
                <a href="{{ url_for('sales') }}"><i class="bi bi-table"></i> Líneas de Venta</a>
            </div>
        </div>
        
        <!-- Dropdown Cobranza -->
        <div class="nav-dropdown">
            <button class="nav-dropdown-toggle">
                <i class="bi bi-cash-coin"></i> Cobranza <i class="bi bi-chevron-down"></i>
            </button>
            <div class="nav-dropdown-menu">
                <a href="{{ url_for('dashboard_cobranza_internacional') }}"><i class="bi bi-globe-americas"></i> Dashboard Internacional</a>
                <a href="{{ url_for('reporte_cxc_general') }}"><i class="bi bi-credit-card"></i> Reporte CxC General</a>
                <a href="{{ url_for('reporte_internacional') }}"><i class="bi bi-file-earmark-text"></i> Reporte Internacional</a>
            </div>
        </div>
        
        <!-- Dropdown Metas -->
        <div class="nav-dropdown">
            <button class="nav-dropdown-toggle">
                <i class="bi bi-bullseye"></i> Metas <i class="bi bi-chevron-down"></i>
            </button>
            <div class="nav-dropdown-menu">
                <a href="{{ url_for('meta') }}"><i class="bi bi-grid-3x3-gap"></i> Metas por Línea</a>
                <a href="{{ url_for('metas_vendedor') }}"><i class="bi bi-people-fill"></i> Metas por Vendedor</a>
            </div>
        </div>
        
        <a href="{{ url_for('logout') }}" class="btn-salir"><i class="bi bi-box-arrow-right"></i> Salir</a>
    </div>
</div>

<script>
// Script para manejar dropdowns con click
document.addEventListener('DOMContentLoaded', function() {
    const dropdowns = document.querySelectorAll('.nav-dropdown');
    
    dropdowns.forEach(dropdown => {
        const toggle = dropdown.querySelector('.nav-dropdown-toggle');
        
        toggle.addEventListener('click', function(e) {
            e.stopPropagation();
            // Cerrar otros dropdowns
            dropdowns.forEach(d => {
                if (d !== dropdown) d.classList.remove('active');
            });
            // Toggle el actual
            dropdown.classList.toggle('active');
        });
    });
    
    // Cerrar dropdowns al hacer click fuera
    document.addEventListener('click', function() {
        dropdowns.forEach(d => d.classList.remove('active'));
    });
});
</script>

<!-- Loading Indicator -->
<div id="loading-indicator" class="loading-indicator">
    <div class="loading-spinner"></div>
    <div>Cargando KPIs de cobranza internacional...</div>
</div>

<div class="filter-bar">
    <div class="filter-bar__content">
        <div style="display: flex; flex-wrap: wrap; gap: var(--space-4); align-items: flex-end; width: 100%;">
            
            <div>
                <label for="start">Desde</label>
                <input type="date" class="form-control" id="start" />
            </div>
            
            <div>
                <label for="end">Hasta</label>
                <input type="date" class="form-control" id="end" />
            </div>
            
            <div>
                <label for="payment_state">Estado de Pago</label>
                <select class="form-select" id="payment_state">
                    <option value="">Todos</option>
                    <option value="not_paid">No Pagado</option>
                    <option value="in_payment">En Pago</option>
                    <option value="paid">Pagado</option>
                    <option value="partial">Parcial</option>
                    <option value="reversed">Reversado</option>
                </select>
            </div>
            
            <div>
                <label for="linea_id">Línea Comercial</label>
                <select class="form-select" id="linea_id">
                    <option value="">Todas</option>
                    <!-- Se llenará dinámicamente -->
                </select>
            </div>
            
            <button class="btn btn--primary" id="btnFiltrar" type="button" title="Buscar">
                <i class="bi bi-search"></i>
            </button>
            <button class="btn btn--secondary" id="btnLimpiar" type="button" title="Limpiar filtros">
                <i class="bi bi-eraser"></i>
            </button>
        </div>
    </div>
</div>

<!-- Dashboard Grid Container -->
<div class="dashboard-grid-container">
    <!-- Grid Layout -->
    <div class="dashboard-grid">
        
        <!-- KPI 1: DSO Promedio -->
        <div class="grid-item grid-kpi-1">
            <div class="kpi-card kpi-primary">
                <div class="kpi-icon"><i class="bi bi-clock-history"></i></div>
                <div class="kpi-title">DSO Promedio</div>
                <div id="kpi-dso" class="kpi-value">-</div>
                <div class="kpi-subtitle">días</div>
            </div>
        </div>

        <!-- KPI 2: CEI -->
        <div class="grid-item grid-kpi-2">
            <div class="kpi-card kpi-success">
                <div class="kpi-icon"><i class="bi bi-check-circle"></i></div>
                <div class="kpi-title">CEI (Efectividad)</div>
                <div id="kpi-cei" class="kpi-value">-</div>
                <div class="kpi-subtitle">%</div>
            </div>
        </div>

        <!-- KPI 3: Deuda Vencida -->
        <div class="grid-item grid-kpi-3">
            <div class="kpi-card kpi-danger">
                <div class="kpi-icon"><i class="bi bi-exclamation-triangle"></i></div>
                <div class="kpi-title">Deuda Vencida</div>
                <div id="kpi-porcentaje-vencido" class="kpi-value">-</div>
                <div id="kpi-monto-vencido" class="kpi-subtitle">-</div>
            </div>
        </div>

        <!-- KPI 4: Deuda Vigente -->
        <div class="grid-item grid-kpi-4">
            <div class="kpi-card kpi-info">
                <div class="kpi-icon"><i class="bi bi-cash-stack"></i></div>
                <div class="kpi-title">Deuda Vigente</div>
                <div id="kpi-monto-vigente" class="kpi-value">-</div>
                <div class="kpi-subtitle">USD</div>
            </div>
        </div>

        <!-- KPI 5: Total Facturas -->
        <div class="grid-item grid-kpi-5">
            <div class="kpi-card">
                <div class="kpi-icon"><i class="bi bi-file-text"></i></div>
                <div class="kpi-title">Total Facturas</div>
                <div id="kpi-total-facturas" class="kpi-value">-</div>
            </div>
        </div>

        <!-- Gráfico 1: Cobranza por Línea -->
        <div class="grid-item grid-chart-1">
            <div class="chart-card">
                <div class="card-header">
                    <i class="bi bi-bar-chart-line"></i> Cobranza por Línea Comercial
                </div>
                <div class="card-body">
                    <div id="cobranzaLineaChart" style="height:100%; min-height:280px"></div>
                </div>
            </div>
        </div>

        <!-- Gráfico 2: Estados de Pago -->
        <div class="grid-item grid-chart-2">
            <div class="chart-card">
                <div class="card-header">
                    <i class="bi bi-pie-chart"></i> Estados de Pago
                </div>
                <div class="card-body">
                    <div id="estadosPagoChart" style="height:100%; min-height:280px"></div>
                </div>
            </div>
        </div>

        <!-- Tabla: Detalle por Línea -->
        <div class="grid-item grid-table-1">
            <div class="table-card">
                <div class="card-header">
                    <i class="bi bi-table"></i> Detalle de Cobranza por Línea
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm table-striped align-middle" id="tblCobranzaLinea">
                            <thead>
                                <tr>
                                    <th>Línea Comercial</th>
                                    <th class="text-end">Facturas</th>
                                    <th class="text-end">Vigente</th>
                                    <th class="text-end">Vencido</th>
                                    <th class="text-end">Total</th>
                                    <th class="text-end">% Vencido</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gráfico 3: Morosidad -->
        <div class="grid-item grid-chart-3">
            <div class="chart-card">
                <div class="card-header">
                    <i class="bi bi-graph-down"></i> Análisis de Morosidad
                </div>
                <div class="card-body">
                    <div id="morosidadChart" style="height:100%; min-height:250px"></div>
                </div>
            </div>
        </div>

        <!-- Top 15 Clientes -->
        <div class="grid-item grid-top15">
            <div class="chart-card">
                <div class="card-header">
                    <i class="bi bi-trophy"></i> Top 15 Clientes con Mayor Deuda
                </div>
                <div class="card-body">
                    <div id="top15Chart" style="height:350px"></div>
                    <div class="table-responsive mt-3">
                        <table class="table table-sm table-striped align-middle" id="tblTop15">
                            <thead>
                                <tr>
                                    <th>Cliente</th>
                                    <th>Documento</th>
                                    <th>Fecha</th>
                                    <th>Vence</th>
                                    <th class="text-end">Monto</th>
                                    <th class="text-end">Saldo</th>
                                    <th>Estado</th>
                                    <th>Origen</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- ECharts 6.0.0 -->
<script src="https://cdn.jsdelivr.net/npm/echarts@6.0.0/dist/echarts.min.js"></script>

<script>
    // Variables globales para los gráficos
    let cobranzaLineaChart, estadosPagoChart, morosidadChart, top15Chart;

    // Función para formatear números
    function formatNumber(n) {
        return new Intl.NumberFormat('es-PE', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        }).format(n || 0);
    }

    // Función para construir query string
    function buildQuery() {
        const start = document.getElementById('start').value;
        const end = document.getElementById('end').value;
        const paymentState = document.getElementById('payment_state').value;
        const lineaId = document.getElementById('linea_id').value;
        const p = new URLSearchParams();
        if (start) p.set('start', start);
        if (end) p.set('end', end);
        if (paymentState) p.set('payment_state', paymentState);
        if (lineaId) p.set('linea_id', lineaId);
        return p.toString();
    }

    // Cargar KPIs
    async function loadKpis() {
        const qs = buildQuery();
        const res = await fetch('/api/cobranza_internacional/kpis' + (qs ? ('?' + qs) : ''));
        if (!res.ok) return;
        const data = await res.json();
        
        // Actualizar KPIs - Fila 1
        document.getElementById('kpi-dso').textContent = formatNumber(data.dso_promedio, 1);
        document.getElementById('kpi-cei').textContent = formatNumber(data.cei, 1) + '%';
        document.getElementById('kpi-porcentaje-vencido').textContent = formatNumber(data.porcentaje_vencido, 1) + '%';
        document.getElementById('kpi-monto-vencido').textContent = '$' + formatNumber(data.monto_vencido);
        document.getElementById('kpi-monto-vigente').textContent = '$' + formatNumber(data.monto_vigente);
        
        // Actualizar KPIs - Fila 2
        document.getElementById('kpi-total-facturas').textContent = data.total_facturas || 0;
        document.getElementById('kpi-morosidad').textContent = formatNumber(data.promedio_dias_morosidad, 1);
        document.getElementById('kpi-tasa-recuperacion').textContent = formatNumber(data.tasa_recuperacion, 1) + '%';
        document.getElementById('kpi-plazo-promedio').textContent = formatNumber(data.plazo_promedio_cobranza, 1);
        
        // Renderizar gráficos
        renderCobranzaLineaChart(data.cobranza_por_linea);
        renderEstadosPagoChart(data.estados_pago);
        renderMorosidadChart(data.morosidad_series);
    }

    // Cargar líneas comerciales
    async function loadLineasComerciales() {
        try {
            const res = await fetch('/api/cobranza/lineas');
            if (res.ok) {
                const data = await res.json();
                const select = document.getElementById('linea_id');
                select.innerHTML = '<option value="">Todas</option>';
                data.forEach(linea => {
                    const option = document.createElement('option');
                    option.value = linea.id;
                    option.textContent = linea.name;
                    select.appendChild(option);
                });
            }
        } catch (error) {
            console.error('Error cargando líneas comerciales:', error);
        }
    }

    // Cargar Top 15
    async function loadTop15() {
        const qs = buildQuery();
        const res = await fetch('/api/cobranza_internacional/top15' + (qs ? ('?' + qs) : ''));
        if (!res.ok) return;
        const data = await res.json();
        
        renderTop15Chart(data.clientes || [], data.montos || []);
        renderTop15Table(data.detalles || []);
    }

    // Cargar tabla de cobranza por línea
    async function loadCobranzaLinea() {
        const qs = buildQuery();
        const res = await fetch('/api/cobranza/linea' + (qs ? ('?' + qs) : ''));
        if (!res.ok) return;
        const data = await res.json();
        
        renderCobranzaLineaTable(data.rows || []);
    }

    // Renderizar gráfico de cobranza por línea
    function renderCobranzaLineaChart(data) {
        const el = document.getElementById('cobranzaLineaChart');
        cobranzaLineaChart = echarts.init(el);
        
        const labels = data?.labels || [];
        const values = data?.values || [];
        
        cobranzaLineaChart.setOption({
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            xAxis: {
                type: 'category',
                data: labels,
                axisLabel: {
                    rotate: 45
                }
            },
            yAxis: {
                type: 'value',
                name: 'Monto'
            },
            series: [{
                data: values,
                type: 'bar',
                itemStyle: {
                    color: '#0d6efd'
                }
            }]
        });
    }

    // Renderizar gráfico de estados de pago
    function renderEstadosPagoChart(estados) {
        const el = document.getElementById('estadosPagoChart');
        estadosPagoChart = echarts.init(el);
        estadosPagoChart.setOption({
            tooltip: {
                trigger: 'item',
                formatter: '{b}: {c} ({d}%)'
            },
            series: [{
                type: 'pie',
                radius: ['40%', '70%'],
                avoidLabelOverlap: false,
                label: {
                    show: true,
                    formatter: '{b}: {c}'
                },
                emphasis: {
                    label: {
                        show: true,
                        fontSize: 14,
                        fontWeight: 'bold'
                    }
                },
                data: estados || [],
                color: ['#0d6efd', '#198754', '#ffc107', '#dc3545', '#6c757d']
            }]
        });
    }

    // Renderizar gráfico de morosidad
    function renderMorosidadChart(series) {
        const el = document.getElementById('morosidadChart');
        morosidadChart = echarts.init(el);
        morosidadChart.setOption({
            tooltip: {
                trigger: 'axis'
            },
            xAxis: {
                type: 'category',
                data: series.labels || []
            },
            yAxis: {
                type: 'value',
                name: 'Días'
            },
            series: [{
                data: series.values || [],
                type: 'line',
                smooth: true,
                lineStyle: {
                    color: '#dc3545'
                },
                itemStyle: {
                    color: '#dc3545'
                }
            }]
        });
    }

    // Renderizar gráfico Top 15
    function renderTop15Chart(clientes, montos) {
        const el = document.getElementById('top15Chart');
        top15Chart = echarts.init(el);
        top15Chart.setOption({
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            xAxis: {
                type: 'value',
                name: 'Monto'
            },
            yAxis: {
                type: 'category',
                data: clientes,
                name: 'Clientes'
            },
            series: [{
                data: montos,
                type: 'bar',
                itemStyle: {
                    color: function(params) {
                        return params.value > 0 ? '#0d6efd' : '#6c757d';
                    }
                }
            }]
        });
    }

    // Renderizar tabla Top 15
    function renderTop15Table(rows) {
        const tbody = document.querySelector('#tblTop15 tbody');
        tbody.innerHTML = '';
        rows.forEach(r => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${r.cliente || ''}</td>
                <td>${r.documento || ''}</td>
                <td>${r.fecha || ''}</td>
                <td>${r.vence || ''}</td>
                <td class="text-end">${formatNumber(r.monto)}</td>
                <td class="text-end fw-semibold">${formatNumber(r.saldo)}</td>
                <td><span class="badge bg-${getPaymentStateColor(r.estado)}">${r.estado || ''}</span></td>
                <td>${r.origen || ''}</td>`;
            tbody.appendChild(tr);
        });
    }

    // Renderizar tabla de cobranza por línea
    function renderCobranzaLineaTable(rows) {
        const tbody = document.querySelector('#tblCobranzaLinea tbody');
        tbody.innerHTML = '';
        rows.forEach(r => {
            const tr = document.createElement('tr');
            const porcentajeVencido = r.total_por_cobrar > 0 ? 
                ((r.monto_vencido / r.total_por_cobrar) * 100).toFixed(1) : 0;
            
            tr.innerHTML = `
                <td>${r.linea_comercial || ''}</td>
                <td class="text-end">${r.facturas_total || 0}</td>
                <td class="text-end">${formatNumber(r.monto_vigente)}</td>
                <td class="text-end">${formatNumber(r.monto_vencido)}</td>
                <td class="text-end fw-semibold">${formatNumber(r.total_por_cobrar)}</td>
                <td class="text-end">${porcentajeVencido}%</td>`;
            tbody.appendChild(tr);
        });
    }

    // Función para obtener color del estado de pago
    function getPaymentStateColor(estado) {
        const colors = {
            'not_paid': 'danger',
            'in_payment': 'warning',
            'paid': 'success',
            'partial': 'info',
            'reversed': 'secondary'
        };
        return colors[estado] || 'secondary';
    }

    // Funciones de loading
    function showLoading() {
        document.getElementById('loading-indicator').style.display = 'block';
    }
    
    function hideLoading() {
        document.getElementById('loading-indicator').style.display = 'none';
    }

    // Event listeners
    document.getElementById('btnFiltrar').addEventListener('click', function() {
        showLoading();
        this.disabled = true;
        
        Promise.all([loadKpis(), loadTop15(), loadCobranzaLinea()]).finally(() => {
            this.disabled = false;
            hideLoading();
        });
    });

    // Limpiar filtros
    document.getElementById('btnLimpiar').addEventListener('click', function() {
        document.getElementById('start').value = '';
        document.getElementById('end').value = '';
        document.getElementById('payment_state').value = '';
        document.getElementById('linea_id').value = '';
        
        // Recargar datos
        showLoading();
        Promise.all([loadKpis(), loadTop15(), loadCobranzaLinea()]).finally(() => {
            hideLoading();
        });
    });

    // Inicializar
    window.addEventListener('load', function() {
        showLoading();
        Promise.all([loadLineasComerciales(), loadKpis(), loadTop15(), loadCobranzaLinea()]).finally(() => {
            hideLoading();
        });
    });

    // Redimensionar gráficos
    window.addEventListener('resize', function() {
        if (cobranzaLineaChart) cobranzaLineaChart.resize();
        if (estadosPagoChart) estadosPagoChart.resize();
        if (morosidadChart) morosidadChart.resize();
        if (top15Chart) top15Chart.resize();
    });
</script>

<style>
/* Loading Indicator */
.loading-indicator {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #0d6efd;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Dashboard Grid Container */
.dashboard-grid-container {
    padding: 20px;
    max-width: 1800px;
    margin: 0 auto;
}

/* Grid Layout Principal */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(5, minmax(120px, auto));
    gap: 16px;
}

/* Grid Items - KPIs */
.grid-kpi-1,
.grid-kpi-2,
.grid-kpi-3,
.grid-kpi-4,
.grid-kpi-5 {
    grid-row: 1;
}

.grid-kpi-1 { grid-column: 1; }
.grid-kpi-2 { grid-column: 2; }
.grid-kpi-3 { grid-column: 3; }
.grid-kpi-4 { grid-column: 4; }
.grid-kpi-5 { grid-column: 5; }

/* Gráfico Cobranza por Línea - 3 columnas */
.grid-chart-1 {
    grid-column: span 3;
    grid-row: 2;
}

/* Gráfico Estados de Pago - 2 columnas */
.grid-chart-2 {
    grid-column: span 2;
    grid-column-start: 4;
    grid-row: 2;
}

/* Tabla Detalle - 3 columnas, 2 filas */
.grid-table-1 {
    grid-column: span 3;
    grid-row: span 2;
    grid-row-start: 3;
}

/* Gráfico Morosidad - 2 columnas, 2 filas */
.grid-chart-3 {
    grid-column: span 2;
    grid-row: span 2;
    grid-column-start: 4;
    grid-row-start: 3;
}

/* Top 15 - 5 columnas (ancho completo) */
.grid-top15 {
    grid-column: span 5;
    grid-row: 5;
}

/* Estilos para los items del grid */
.grid-item {
    height: 100%;
    display: flex;
    flex-direction: column;
}

.grid-item .kpi-card,
.grid-item .chart-card,
.grid-item .table-card {
    height: 100%;
    display: flex;
    flex-direction: column;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}

.grid-item .kpi-card:hover,
.grid-item .chart-card:hover,
.grid-item .table-card:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    transform: translateY(-2px);
}

.grid-item .card-body {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.grid-item .card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 12px 16px;
    font-weight: 600;
    border-radius: 8px 8px 0 0;
    display: flex;
    align-items: center;
    gap: 8px;
}

.grid-item .card-header i {
    font-size: 1.1em;
}

/* Responsive Design */
@media (max-width: 1400px) {
    .dashboard-grid {
        grid-template-columns: repeat(4, 1fr);
    }
    
    .grid-kpi-5 {
        grid-column: 1;
        grid-row: 2;
    }
    
    .grid-chart-1 {
        grid-column: span 2;
        grid-row: 2;
        grid-column-start: 2;
    }
    
    .grid-chart-2 {
        grid-column: span 2;
        grid-column-start: 4;
        grid-row: 2;
    }
    
    .grid-table-1 {
        grid-column: span 4;
        grid-row: 3;
    }
    
    .grid-chart-3 {
        grid-column: span 4;
        grid-row: 4;
    }
    
    .grid-top15 {
        grid-column: span 4;
        grid-row: 5;
    }
}

@media (max-width: 992px) {
    .dashboard-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }
    
    .grid-kpi-1,
    .grid-kpi-2,
    .grid-kpi-3,
    .grid-kpi-4,
    .grid-kpi-5 {
        grid-column: span 1;
    }
    
    .grid-kpi-1 { grid-row: 1; grid-column: 1; }
    .grid-kpi-2 { grid-row: 1; grid-column: 2; }
    .grid-kpi-3 { grid-row: 2; grid-column: 1; }
    .grid-kpi-4 { grid-row: 2; grid-column: 2; }
    .grid-kpi-5 { grid-row: 3; grid-column: 1; }
    
    .grid-chart-1,
    .grid-chart-2,
    .grid-table-1,
    .grid-chart-3,
    .grid-top15 {
        grid-column: span 2;
        grid-row: auto;
    }
}

@media (max-width: 576px) {
    .dashboard-grid {
        grid-template-columns: 1fr;
    }
    
    .grid-kpi-1,
    .grid-kpi-2,
    .grid-kpi-3,
    .grid-kpi-4,
    .grid-kpi-5,
    .grid-chart-1,
    .grid-chart-2,
    .grid-table-1,
    .grid-chart-3,
    .grid-top15 {
        grid-column: span 1;
    }
}
</style>
</div> <!-- Cierre del div dashboard-cobranza -->
{% endblock %}
